---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { SectionTitle } from "@/components/ui/section-title";
import FancyImage from "@/components/fancy-image.astro";
import { loadProjectImages } from "@/lib/load-project-images";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();

const images = loadProjectImages(project.slug, project.data.images || []);
---

<Layout title={project.data.title}>
  <main>
    <article>
      <div class="flex flex-col md:flex-row gap-12 w-full mb-6 md:mb-12">
        <header class="flex flex-col gap-8 md:w-2/3">
          <SectionTitle label="Title">
            <h1 class="text-3xl">{project.data.title}</h1>
          </SectionTitle>
          <SectionTitle label="Date">
            <p class="text-sm text-muted-foreground">
              {
                project.data.date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })
              }
            </p>
          </SectionTitle>
          <SectionTitle label="Categories">
            {
              project.data.categories.map((category: string, index: number) => (
                <span class="text-3xl">
                  {category}
                  {index < project.data.categories.length - 1 && (
                    <span class="text-muted-foreground -ms-3">,</span>
                  )}
                </span>
              ))
            }
          </SectionTitle>
        </header>
        <div class="md:w-1/2">
          <SectionTitle label="Details">
            <p><Content /></p>
          </SectionTitle>
        </div>
      </div>
      {
        images.length > 0 && (
          <section class="w-full px-4">
            <div class="columns-1 md:columns-2 gap-4 space-y-4">
              {images.map((img) => (
                <div class="break-inside-avoid">
                  <FancyImage
                    src={img}
                    alt={project.data.title}
                    widths={[400, 800, 1200, 1600, 2400]}
                    sizes="100vw, 50vw"
                  />
                </div>
              ))}
            </div>
          </section>
        )
      }
    </article>
  </main>
</Layout>
